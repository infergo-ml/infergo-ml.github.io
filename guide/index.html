<!DOCTYPE html>
<html class="nojs" lang="en-GB" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Guide – Infergo – Go programs that learn</title>

<meta name="created" content="0001-01-01T00:00:00+0000">
<meta name="modified" content="0001-01-01T00:00:00+0000">
<meta name="author" content="David Tolpin">
<meta name="contact" content="david.tolpin@gmail.com">
<meta property="og:site_name" content="Infergo – Go programs that learn">
<meta property="og:title" content="Guide">
<meta property="og:url" content="https://infergo.org/guide/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://infergo.org/apple-touch-icon.png">
<meta name="generator" content="Hugo 0.152.2">



<link rel="canonical" href="https://infergo.org/guide/">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<link rel="stylesheet" href="/css/styles.d13ddd933162a6d5541bfe958cbb8d761047ea95dac664677d688b5f2e6fcc99.css">
<link rel="stylesheet" href="/css/mobilemenu.295c7ca420e20bb22a98ef9b836cdd291aec4bac9f10e6369bd3ef17f539a522.css" media="screen">
<link rel="stylesheet" href="/css/print.c9925dbab6fd256f753b0319c569e85f28a89b8cbd71238bde2452f74dcdf761.css" media="print">

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "headline": "Guide",
    "datePublished": "0001-01-01T00:00:00Z",
    "dateModified": "0001-01-01T00:00:00Z",
    "url" : "https://infergo.org/guide/",
    
    "image" : "https://infergo.org/apple-touch-icon.png",
    "author": {
      "@type": "Person",
      "name": "David Tolpin"
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://infergo.org/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Infergo – Go programs that learn",
      "logo" : {
        "@type": "ImageObject",
        "url": "https://infergo.org/apple-touch-icon.png"
      },
      "url": "https://infergo.org/"
    }
  }
</script>

<script>
(()=>{(function(){document.querySelector("html").classList.replace("nojs","js")})();})();

</script>

<script defer src="/js/mobilemenu.7ce1f75fd1d49cd683a008352ad9001f800349629be01d531a19c02b5a84817b.js"></script>
<script defer src="/js/script.f2979a93a325fecf9605263bd141398a311c8e23388ed7dcff74f92f7e632866.js"></script>






</head>

<body class="single-page">
<div class="page layout__page layout__sidebar-second">
<header class="header layout__header">
<a href="/" title="Home" rel="home" class="header__logo">
<img src="/images/logo.png" width="64" alt="Home" class="header__logo-image">
</a>
<h1 class="header__site-name">
<a href="/" title="Home" class="header__site-link" rel="home"><span>Infergo – Go programs that learn</span></a>
</h1>
<div class="region header__region">
</div>
</header>

<nav class="main-menu mx--xs layout__navigation" aria-label="Main menu">
<ul class="flex-inline mx--0">
<li><a href="/"><span>Home</span></a></li>
<li><a href="/start/"><span>Getting started</span></a></li>
<li><a href="/guide/" aria-current="page"><span>Guide</span></a></li>
<li><a href="/examples/"><span>Examples</span></a></li>
<li><a href="/news/"><span>News</span></a></li>
<li><a href="/peers/"><span>Peers</span></a></li>
<li><a href="/team/"><span>Team</span></a></li>
</ul>
</nav>
<div class="mobile-nav" dir="ltr" hidden>
  <div class="mobile-nav__cover"></div>
  <button class="mobile-nav__toggle button" aria-expanded="false" aria-controls="sheet">
    Menu
    <svg class="mobile-nav__hamburger" viewBox="0 0 100 100" focusable="false" aria-hidden="true">
      <rect width="80" height="12" x="10" y="20" rx="5"></rect>
      <rect width="80" height="12" x="10" y="45" rx="5"></rect>
      <rect width="80" height="12" x="10" y="70" rx="5"></rect>
    </svg>
  </button>
  <div class="mobile-nav__sheet link-inverted link-nav" id="sheet" aria-hidden="true">
    <div class="mobile-nav__region"></div>
    <nav class="mobile-nav__main-menu" aria-label="Main menu">
    <ul class="mobile-nav__navbar">
    <li><a href="/"><span>Home</span></a></li>
    <li><a href="/start/"><span>Getting started</span></a></li>
    <li><a href="/guide/" aria-current="page"><span>Guide</span></a></li>
    <li><a href="/examples/"><span>Examples</span></a></li>
    <li><a href="/news/"><span>News</span></a></li>
    <li><a href="/peers/"><span>Peers</span></a></li>
    <li><a href="/team/"><span>Team</span></a></li>
    </ul>
    </nav>
  </div>
</div>
<main class="main layout__main">
<article class="single-view">
<header>
<h1 class="title mb--xxs">Guide</h1>
<div class="submitted meta">
<span class="author" itemprop="author">David Tolpin</span>

</div>
</header>

<p><a href="https://godoc.org/bitbucket.org/dtolpin/infergo"><img src="https://godoc.org/bitbucket.org/dtolpin/infergo?status.svg" alt="GoDoc"></a></p>
<h2 id="code">Code</h2>
<h3 id="model">Model</h3>
<p>A model is defined in it&rsquo;s own package. The model must implement
interface
<a href="https://godoc.org/bitbucket.org/dtolpin/infergo/model#Model"><code>model.Model</code></a>,
consisting of a single method <code>Observe([]float64) float64</code>. In
the model&rsquo;s source code:</p>
<ol>
<li>Methods on the type implementing <code>model.Model</code> returning a
single float or nothing are differentiated.</li>
<li>Within the methods, the following is differentiated:</li>
</ol>
<ul>
<li>assignments to <code>float64</code> (including parallel
assignments if all values are of type <code>float64</code>);</li>
<li>returns of float64;</li>
<li>standalone calls to methods on the type implementing
model.Model (apparently called for side  effects on
the model).</li>
</ul>
<ol start="3">
<li>Imported package name <code>ad</code> is reserved.</li>
<li>Non-dummy identifiers starting with the prefix for
generated identifiers (<code>_</code> by default) are reserved.</li>
</ol>
<p>Derivatives do not propagate through a function that is not
an elemental or a call to a model method. If a derivative is
not registered for an elemental, calling the elemental in a
differentiated context will cause a run-time error.</p>
<h4 id="elemental-model">Elemental model</h4>
<p>If method <code>Gradient() []float64</code> is provided for a model type,
the model is treated as an &rsquo;elemental&rsquo; model, and the gradient
returned by <code>Gradient()</code> is used by inference algorithms. This
allows to code the gradient by hand instead of relying on
automatic differentiation.</p>
<h3 id="elementals">Elementals</h3>
<p>Functions are considered elementals (and must have a
registered derivative) if their signature is either of kind</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">func</span><span style="color:#bbb"> </span>(<span style="color:#902000">float64</span>,<span style="color:#bbb"> </span><span style="color:#902000">float64</span><span style="color:#666">*</span>)<span style="color:#bbb"> </span><span style="color:#902000">float64</span></span></span></code></pre></div>
<p>that is, one or more non-variadic <code>float64</code> arguments and
<code>float64</code> return value, or
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">func</span><span style="color:#bbb"> </span>([]<span style="color:#902000">float64</span>)<span style="color:#bbb"> </span><span style="color:#902000">float64</span></span></span></code></pre></div></p>
<p>For example, functions</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">func</span><span style="color:#bbb"> </span><span style="color:#06287e">foo</span>(<span style="color:#902000">float64</span>,<span style="color:#bbb"> </span><span style="color:#902000">float64</span>,<span style="color:#bbb"> </span><span style="color:#902000">float64</span>)<span style="color:#bbb"> </span><span style="color:#902000">float64</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">func</span><span style="color:#bbb"> </span><span style="color:#06287e">bar</span>([]<span style="color:#902000">float64</span>)<span style="color:#bbb"> </span><span style="color:#902000">float64</span></span></span></code></pre></div>
<p>are considered elementals, while functions</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">func</span><span style="color:#bbb"> </span><span style="color:#06287e">fee</span>(<span style="color:#666">...</span><span style="color:#902000">float64</span>)<span style="color:#bbb"> </span><span style="color:#902000">float64</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">func</span><span style="color:#bbb"> </span><span style="color:#06287e">buz</span>(<span style="color:#902000">int</span>,<span style="color:#bbb"> </span><span style="color:#902000">float64</span>)<span style="color:#bbb"> </span><span style="color:#902000">float64</span></span></span></code></pre></div>
<p>are not. Gradients for selected functions from the <code>math</code>
package are pre-defined (<code>Sqrt</code>, <code>Exp</code>, <code>Log</code>, <code>Pow</code>, <code>Sin</code>,
<code>Cos</code>, <code>Tan</code>, <code>Erf</code>, <code>Erfc</code>). Auxiliary elemental functions with
pre-defined gradients are in
<a href="https://godoc.org/bitbucket.org/dtolpin/infergo/mathx">bitbucket.org/dtolpin/infergo/mathx</a>.</p>
<h3 id="distributions">Distributions</h3>
<p>Distributions are models. Several distributions are provided in
<a href="https://godoc.org/bitbucket.org/dtolpin/infergo/dist">bitbucket.org/dtolpin/infergo/dist</a>.
In addition to the <code>Observe</code> method, distributions have <code>Logp</code>
(single observation) and <code>Logps</code> (multiple observations) methods
which accept distribution parameters and observations as
individual arguments rather than in a single slice.</p>
<h2 id="differentiation">Differentiation</h2>
<p>Command-line utility <code>deriv</code> is used to differentiate a model.
The command-line syntax is:</p>
<pre><code>deriv path/to/model/package
</code></pre>
<p>For example,</p>
<pre><code>deriv examples/hello/model
</code></pre>
<p>Run <code>deriv -h</code> for the full list of command-line options.  The
differentiated model is put into subpackage &ldquo;ad&rdquo; of the model&rsquo;s
package, with the same name as the original package.</p>
<h2 id="inference">Inference</h2>
<p>For inference, <code>infergo</code> offers</p>
<ul>
<li>optimization via <a href="https://en.wikipedia.org/wiki/Gradient_descent">gradient
ascent</a> methods.</li>
<li>full posterior inference via <a href="https://en.wikipedia.org/wiki/Hamiltonian_Monte_Carlo">Hamiltonian Monte Carlo</a> variants.</li>
</ul>
<h3 id="optimization">Optimization</h3>
<p>An optimizer implements interface
<a href="https://godoc.org/bitbucket.org/dtolpin/infergo/infer#Grad"><code>infer.Grad</code></a>.
Interface implementations are <a href="https://godoc.org/bitbucket.org/dtolpin/infergo/infer#Momentum">gradient ascent with
momentum</a>
and
<a href="https://godoc.org/bitbucket.org/dtolpin/infergo/infer#Adam">Adam</a>.
Both methods are capable to work with stochastic data (e.g.
streams or batches).</p>
<h3 id="full-posterior">Full posterior</h3>
<p>An MCMC sampler for full posterior inference implements interface
<a href="https://godoc.org/bitbucket.org/dtolpin/infergo/infer#MCMC"><code>infer.MCMC</code></a>. Inteface implementations are <a href="https://godoc.org/bitbucket.org/dtolpin/infergo/infer#HMC">HMC</a> and <a href="https://godoc.org/bitbucket.org/dtolpin/infergo/infer#NUTS">NUTS</a>.</p>
<p><a href="https://godoc.org/bitbucket.org/dtolpin/infergo/infer#DepthAdapter"><code>DepthAdapter</code></a> enables adaption of NUTS step size with respect to the average
tree depth.</p>


</article>
</main>


<aside class="sidebar layout__second-sidebar">
<nav class="menu">
<p class="title"><strong><a href="/peers/">Peers</a></strong></p>
<ul>
<li><a href="/peers/gogp/">GoGP</a></li>
</ul>
</nav>
<nav class="menu">
<p class="title"><strong><a href="/news/">News</a></strong></p>
<ul>
<li><a href="/news/v1.2.2/">infergo v1.2.2</a></li>
<li><a href="/news/gogp-v1.0.1/">gogp v1.0.1</a></li>
<li><a href="/news/v1.0.1/">infergo v1.0.1</a></li>
<li><a href="/news/gogp/">gogp v0.1.0</a></li>
<li><a href="/news/v0.7.0/">infergo v0.7.0</a></li>
<li><a href="/news/v0.6.1/">infergo v0.6.1</a></li>
<li><a href="/news/v0.5.0/">infergo v0.5.0</a></li>
<li><a href="/news/tale-of-goids/">The Tale of GoIDs</a></li>
<li><a href="/news/v0.3.0/">infergo v0.3.0</a></li>
<li><a href="/news/v0.2.2/">infergo v0.2.2</a></li>
<li><a href="/news/v0.2.1/">infergo v0.2.1</a></li>
<li><a href="/news/why/">Why infergo</a></li>
</ul>
</nav>
</aside>
<footer class="footer layout__footer mt--l">
<p><span>© Infergo – Go programs that learn</span></p>

<p>Powered by <a href="https://gohugo.io/">Hugo</a> and the <a href="https://github.com/frjo/hugo-theme-zen">Zen theme</a>.</p>

</footer>

</div>
</body>
</html>
